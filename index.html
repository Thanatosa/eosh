<html>
<head>
  <meta charset="utf-8">
  <script>
    function select_endpoint()
    {
      document.getElementById('ref_block_num').innerHTML = "ref_block_num: " 
      document.getElementById('ref_block_prefix').innerHTML = "ref_block_prefix: " 

      let api_endpoint = document.getElementById('api_endpoint').value;
      let chain_info = new XMLHttpRequest();
      chain_info.open('GET', api_endpoint+"v1/chain/get_info", true);
      chain_info.responseType = 'json';
      chain_info.onload = function()
      {
        if (this.status === 200)
        {
          document.getElementById('ref_block_num').innerHTML = "ref_block_num: " + this.response.last_irreversible_block_num;

          var last_irreverisble_block = new XMLHttpRequest();
          last_irreverisble_block.open('POST', api_endpoint+"v1/chain/get_block", true);
          last_irreverisble_block.responseType = 'json';
          last_irreverisble_block.onreadystatechange = function()
          {
            if(this.readyState == XMLHttpRequest.DONE && this.status == 200)
            {
              document.getElementById('ref_block_prefix').innerHTML = "ref_block_prefix: " + this.response.ref_block_prefix;
            }
          }
          last_irreverisble_block.onerror = function()
          {
            alert("error");
          }
          let inputdata='{"block_num_or_id": ' + this.response.last_irreversible_block_num + '}'
          last_irreverisble_block.send(inputdata);
        }
        else
        {
          alert("Error: " + this.status);
        }
      };
      chain_info.send('');
    };

    function broadcast_transaction()
    {
      document.getElementById('json').innerHTML = "";
      document.getElementById('response').innerHTML = "";

      let api_endpoint = document.getElementById('api_endpoint').value;
      var push_transaction = new XMLHttpRequest();
      push_transaction.open('POST', api_endpoint+"v1/chain/push_transaction", true);
      push_transaction.responseType = 'json';
      push_transaction.onreadystatechange = function()
      {
        json_response = JSON.stringify(this.response, null, 2);
        document.getElementById('response').innerHTML = "Response from " + api_endpoint + " (" + this.readyState + ", " + this.status + ")\n\n" + json_response;
      }
      let transaction = document.getElementById('transaction').value;
      let json_transaction = JSON.parse(transaction);
      push_transaction.send(transaction);
      json_transaction = JSON.stringify(json_transaction, null, 2);
      document.getElementById('json').innerHTML = "Sending to " + api_endpoint + "\n \n" + json_transaction;
    };
  </script>
</head>

<body>
  <body bgcolor="#C0C0C0"> 
  <a href="https://github.com/Thanatosa/eosh">
    <img src="icons/64x64.png">
  </a>
  <h1>EOS mainnet transaction broadcast</h1>
  <form action="javascript:select_endpoint()">
    API endpoint 
    <select id="api_endpoint" required>
      <option value="https://api.eosnewyork.io:443/">eosnewyorkio</option>
      <option value="https://api1.eosasia.one/">eosasia11111</option></option>
      <option value="https://api.eosrio.io/">eosriobrazil</option>
      <option value="https://api.eossweden.se:443/">eosswedenorg</option>
      <option value="https://api.eosuk.io:443/">eosukblocpro</option>
      <option value="https://api.main.alohaeos.com:443/">alohaeosprod</option>
      <option value="https://api.tokenika.io/">tokenika4eos</option></option>
      <option value="https://api-eos.blckchnd.com/">blockchained</option></option>
      <option value="https://api2.eostribe.io/">eostribeprod</option>
      <option value="https://eos.greymass.com:443/">teamgreymass</option>
      <option value="https://eosapi.blockmatrix.network:443/">blockmatrix1</option>
      <option value="https://eu1.eosdac.io:443/">eosdacserver</option>
      <option value="https://node2.liquideos.com:8883/">eosliquideos</option>
    </select>
    <br>
    <p id="ref_block_num">ref_block_num: </p>
    <p id="ref_block_prefix">ref_block_prefix: </p>
    <input type="submit" value="get block">
  </form>
  <form action="javascript:broadcast_transaction()">
    <textarea id="transaction" style="width: 320px; height: 240px;" placeholder="paste transaction here" required></textarea>
    <br/>
    <input type="submit" value="Broadcast">
  </form>
  <pre id="json"></pre>
  <pre id="response"></pre>
  <br/>
</body>
</html>



